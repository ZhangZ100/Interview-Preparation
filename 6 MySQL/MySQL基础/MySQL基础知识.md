## 存储引擎



#### InnoDB

![image-20220115195940741](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220115195940741.png)

- 支持事务
- MySQL默认使用InnoDB作为存储引擎
- 除非需要用到 InnoDB 不具有的特性，否则绝大多数情况最好选用 InnoDB存储引擎
- 采用 MVCC 支持高并发
- 实现了4个标准的隔离级别（读未提及，读提交，可重复读，串行化），并默认级别是可重复读（REPEATABLE READ), 并且在可重复读的级别下，通过 MVCC+Next-Key Locking防止幻读
- 主索引时聚簇索引，在索引中保存了数据，从而避免了直接读取磁盘，因此对主键查询有很高的性能
- InnoDB内部做了很多优化：
  - 包括从磁盘读取数据时采用可预测性读
  - 能够自动在内存中创建hash索引以加速读操作的自适应哈希索引
  - 以及能够加速插入操作的插入缓冲区等
- InnoDB 支持真正的在线热备份（MySQL 其他的存储引擎不支持在线热备份，要获取一致性视图需要停止对所有表的写入，而在读写混合的场景中，停止写入可能也意味着停止读取）



#### MyISAM

![image-20220115200907166](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220115200907166.png)

#### InnoDB 和 MyISAM 的比较



![image-20220115201116924](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220115201116924.png)



## 索引



#### B+Tree原理

![image-20220117235937262](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220117235937262.png)

![image-20220118000050543](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220118000050543.png)



**操作**

![image-20220118000128698](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220118000128698.png)

![image-20220118003314791](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220118003314791.png)

**树的常见特性**

![image-20220119122404859](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119122404859.png)



![image-20220119122511429](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119122511429.png)

![image-20220119122525049](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119122525049.png)



#### MySQL索引

索引是在存储引擎层实现的，而不是在服务器层实现的，所以不同存储引擎具有不同的索引类型和实现。



**B+Tree索引**

![image-20220119122915160](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119122915160.png)

![image-20220119122929586](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119122929586.png)

![image-20220119123002277](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123002277.png)



**哈希索引**

![image-20220119123035343](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123035343.png)

**全文索引**

![image-20220119123106021](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123106021.png)

**空间数据索引**

![image-20220119123150373](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123150373.png)



#### 索引优化



**独立的列**

![image-20220119123244720](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123244720.png)



**多列索引**

![image-20220119123332902](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123332902.png)



**索引列的顺序**

![image-20220119123438876](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123438876.png)



**前缀索引**

![image-20220119123538637](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123538637.png)

**覆盖索引**

![image-20220119123605731](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123605731.png)

#### 索引的优点

![image-20220119123702179](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123702179.png)

#### **索引的使用条件**

![image-20220119123755732](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123755732.png)



#### **查询性能优化**

![image-20220119123943548](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119123943548.png)

![image-20220119124028680](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124028680.png)

![image-20220119124050936](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124050936.png)

![image-20220119124307689](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124307689.png)



![image-20220119124417592](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124417592.png)

![image-20220119124506942](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124506942.png)

![image-20220119124617577](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124617577.png)



![image-20220119124629804](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124629804.png)

#### 优化数据访问

![image-20220119124658716](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119124658716.png)

#### 重构查询方式

![image-20220119125022639](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125022639.png)



![image-20220119125037250](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125037250.png)



## 事务

![image-20220119125159569](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125159569.png)



![image-20220119125213903](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125213903.png)

![image-20220119125227515](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125227515.png)

![image-20220119125310119](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125310119.png)

![image-20220119125409590](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125409590.png)



## 锁

![image-20220119125544075](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125544075.png)



![image-20220119125608117](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125608117.png)



#### MVCC

![image-20220119125653444](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125653444.png)

![image-20220119125715676](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119125715676.png)

![image-20220119134217136](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119134217136.png)

![image-20220119134307075](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119134307075.png)

![image-20220119134730047](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119134730047.png)

![image-20220119134813380](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119134813380.png)



#### 锁算法

![image-20220119134954453](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119134954453.png)

![image-20220119135003998](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135003998.png)

#### 锁问题

![image-20220119135149685](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135149685.png)

![image-20220119135220359](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135220359.png)

![image-20220119135319099](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135319099.png)



![image-20220119135335155](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135335155.png)

![image-20220119135410768](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135410768.png)

![image-20220119135442744](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135442744.png)

![image-20220119135509689](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135509689.png)



## 复制

![image-20220119135604380](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135604380.png)

![image-20220119135658343](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135658343.png)



## JSON

![image-20220119135854052](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135854052.png)

![image-20220119135932112](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119135932112.png)

![image-20220119140307453](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140307453.png)

![image-20220119140314974](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140314974.png)

![image-20220119140330431](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140330431.png)

## 关系数据库设计理论

![image-20220119140406415](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140406415.png)

![image-20220119140449008](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140449008.png)

![image-20220119140553608](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140553608.png)

![image-20220119140618928](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140618928.png)

![image-20220119140707747](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140707747.png)

![image-20220119140738749](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140738749.png)

![image-20220119140857402](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140857402.png)

![image-20220119140932216](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140932216.png)

![image-20220119140950625](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119140950625.png)

![image-20220119141010267](MySQL%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.assets/image-20220119141010267.png)













## 来源，链接

来自 敖丙

https://mp.weixin.qq.com/s/J3kCOJwyv2nzvI0_X0tlnA















